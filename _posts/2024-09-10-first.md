---
title: Relevant Penetration Testing CHallenge Walkthrough
author: Charity Nyongesa
categories: [THM, Walkthroughs]
tags: [THM]
pin: true
math: true
mermaid: true
---


I am currently solving the [Tryhackme relevant](https://tryhackme.com/r/room/relevant) penetration testing challenge.

## Step 1: Scan the target

The first step is to initiate an nmap scan to discover open ports and services running on the vulnerable machine. From the results below, I discoved open ports 80, 445, . You can note that the target machine is a windows server machine that has theSMB protocol running on port 445. I then tried accessing the web server with the open port 80. We find that the default Microsft page appears.

![NMAP](/assets/img/relevant/ECho.png)

<img src="/assets/img/relevant/ECho.png" alt="ECho Image">



## Step 2: Enumeration

I enumerated the open services with my main focus on the SMB service and HTTP. I tried accessing the web server and scanning for hidden directories using gobuster. This did not yield anything. 

I then ran `smbclient \\\\ip address`.I discovered the following shares in the network. 
![](/assets/img/relevant/SMB1.png)


The previous capture reveals the presence of a non-standard network share 'nt4wrksv'. I then tried accessing this network share. I guessed passwords and noted that with a blank password one is able to get access to the contents of the folder. 


![](//assets/img/relevant/passwords.png)



The folder contains a **passwords.txt** file. I then used the curl command to pull the passwords.txt file to my machine. You can use the get command in the smb shell to

![](assets/img/relevant/CURL.png)



This file contains two **base64 encoded** lines. By decoding each line using this file, I was able to obtain Bob and Bill passwords.

![](assets/img/relevant/ECho.png)

![](assets/img/relevant/ECho1.png)

## Web

Scanning the hidden web directories on both ports `80/tcp` and `49663/tcp` takes a while but is worth it (with `directory-list-2.3-medium.txt`). Nothing interesting stands out on port `80/tcp`, but we find that the `nt4wrksv` share found previously is also available as a hidden location on port `49663/tcp`.

I try to access the passwords file from the web browser and that also reveals the contents of the files.

## Step 3: Exploitation

We now try to execute the payload. First create a reverse payload and upload it on the web server. Use msfvenom


![](assets/img/relevant/venom.png)


Upload the reverse shell on the server.
![](assets/img/relevant/put.png)


Start a listener on metasploit

![](assets/img/relevant/listener.png)

And call the reverse shell in the browser or with `curl`



This starts a meterpreter session

The user flag can be found at 

## Step 5: Privilege escalation
Lets explore possible avenues for privilege escalation. To see the privileges for the meterpreter session, use the getprivs commands. 
AFter searching, I noticed that the 'SeImpersonatePrivilege can be used for privilege escalation.

![](/assets/img/relevant/privs.png) 

Exploiting SeImpersonatePrivilege:
PrintSpoofer:
PrintSpoofer is a tool that leverages the SeImpersonatePrivilege to achieve privilege escalation. It exploits a feature in the Windows Print Spooler.


PrintSpoofer.exe -i -c cmd.exe

This will open a command prompt running as SYSTEM.
